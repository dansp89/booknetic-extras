!function(t){"use strict";t(document).ready((function(){booknetic.initMultilangInput(t("#input_location_name"),"locations","name"),booknetic.initMultilangInput(t("#input_address"),"locations","address"),booknetic.initMultilangInput(t("#input_note"),"locations","notes"),t(".fs-modal").on("click","#addLocationSave",(function(){let e=t("#input_location_name").val(),o=t("#input_phone").val(),s=t("#input_address").val(),d=t("#input_note").val(),i=t("#input_image")[0].files[0];if(""===e)return void booknetic.toast(booknetic.__("fill_all_required"),"unsuccess");const l=t("#add_new_JS").data("location-id"),c=new FormData;c.append("location_name",e),c.append("address",s),c.append("phone",o),c.append("note",d),c.append("image",i),c.append("latitude",n&&n.getLatLng?n.getLatLng().lat:""),c.append("longitude",n&&n.getLatLng?n.getLatLng().lng:""),c.append("address_components",a||""),c.append("translations",booknetic.getTranslationData(t(".fs-modal").first()));const r=()=>{const e=t("#fs_data_table_div");booknetic.modalHide(t(".fs-modal")),e.length>0&&booknetic.dataTable.reload(e)};l?(c.append("id",l),booknetic.ajax("locations.update",c,r)):booknetic.ajax("locations.create",c,r)})).on("click","#hideLocationBtn",(function(){const e=t("#add_new_JS").data("location-id");booknetic.ajax("toggleVisibility",{id:e},(function(){booknetic.modalHide(t(".fs-modal")),booknetic.dataTable.reload(t("#fs_data_table_div"))}))}));let e,n,a,o=t("#add_new_JS").data("latitude")||0,s=t("#add_new_JS").data("longitude")||0,d=o>0?15:2;function i(){const t=[o,s];e=L.map("divmap").setView(t,d),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}).addTo(e),n=L.marker(t,{draggable:!0}).addTo(e),o>0?l(t):navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const a=[t.coords.latitude,t.coords.longitude];e.setView(a,15),n.setLatLng(a),l(a)}),(t=>{})),n.on("dragend",(function(){const t=n.getLatLng();l([t.lat,t.lng])})),e.on("click",(function(t){n.setLatLng(t.latlng),l([t.latlng.lat,t.latlng.lng])})),function(){let t;document.getElementById("input_address").addEventListener("input",(function(a){clearTimeout(t);const o=a.target.value;o.length<3||(t=setTimeout((()=>{!function(t){fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=5`).then((t=>t.json())).then((t=>{if(t&&t.length>0){const a=t[0],o=[parseFloat(a.lat),parseFloat(a.lon)];e.setView(o,15),n.setLatLng(o),c(a);const s=document.getElementById("input_address");s&&a.display_name&&(s.value=a.display_name)}})).catch((t=>{}))}(o)}),500))}))}()}function l(t){fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t[0]}&lon=${t[1]}`).then((t=>t.json())).then((t=>{if(t&&t.address){c(t);const e=document.getElementById("input_address");e&&t.display_name&&(e.value=t.display_name)}else a=""})).catch((t=>{a=""}))}function c(t){if(a="",t.address){const e=[];t.address.road&&e.push(t.address.road),t.address.house_number&&e.push(t.address.house_number),t.address.neighbourhood&&e.push(t.address.neighbourhood),t.address.suburb&&e.push(t.address.suburb),t.address.city&&e.push(t.address.city),t.address.state&&e.push(t.address.state),t.address.country&&e.push(t.address.country),t.address.postcode&&e.push(t.address.postcode),a=e.join(">")}else t.display_name&&(a=t.display_name.replace(/, /g,">"))}new Promise(((t,e)=>{if("undefined"!=typeof L)return void t();const n=document.createElement("link");n.rel="stylesheet",n.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",n.integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=",n.crossOrigin="",document.head.appendChild(n);const a=document.createElement("script");a.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",a.integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=",a.crossOrigin="",a.onload=t,a.onerror=e,document.head.appendChild(a)})).then((()=>{setTimeout((()=>{i()}),100)})).catch((t=>{booknetic.toast("Failed to load map library","unsuccess")}))}))}(jQuery);